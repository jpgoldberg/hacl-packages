<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Cryspen HACL Packages</title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Introduction</a></li><li class="chapter-item expanded "><a href="algorithms.html"><strong aria-hidden="true">1.</strong> Algorithms</a></li><li class="chapter-item expanded "><a href="platforms.html"><strong aria-hidden="true">2.</strong> Platforms</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="architectures.html"><strong aria-hidden="true">2.1.</strong> Architectures</a></li></ol></li><li class="chapter-item expanded "><a href="installation.html"><strong aria-hidden="true">3.</strong> Installation</a></li><li class="chapter-item expanded affix "><li class="part-title">Building</li><li class="chapter-item expanded "><a href="mach/index.html"><strong aria-hidden="true">4.</strong> mach</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="mach/build.html"><strong aria-hidden="true">4.1.</strong> build</a></li><li class="chapter-item expanded "><a href="mach/test.html"><strong aria-hidden="true">4.2.</strong> test</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">HACL C</li><li class="chapter-item expanded "><a href="hacl-c/index.html"><strong aria-hidden="true">5.</strong> Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="hacl-c/hacl-apis.html"><strong aria-hidden="true">5.1.</strong> HACL APIs</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="hacl-c/hacl-aead.html"><strong aria-hidden="true">5.1.1.</strong> AEAD</a></li><li class="chapter-item expanded "><a href="hacl-c/hacl-hashing.html"><strong aria-hidden="true">5.1.2.</strong> Hasing</a></li><li class="chapter-item expanded "><a href="hacl-c/hacl-hmac.html"><strong aria-hidden="true">5.1.3.</strong> HMAC</a></li><li class="chapter-item expanded "><a href="hacl-c/hacl-hkdf.html"><strong aria-hidden="true">5.1.4.</strong> HKDF</a></li><li class="chapter-item expanded "><a href="hacl-c/hacl-ecdh.html"><strong aria-hidden="true">5.1.5.</strong> ECDH</a></li><li class="chapter-item expanded "><a href="hacl-c/hacl-signatures.html"><strong aria-hidden="true">5.1.6.</strong> Signatures</a></li><li class="chapter-item expanded "><a href="hacl-c/hacl-nacl.html"><strong aria-hidden="true">5.1.7.</strong> Crypto Box</a></li><li class="chapter-item expanded "><a href="hacl-c/hacl-randomness.html"><strong aria-hidden="true">5.1.8.</strong> Randomness</a></li></ol></li><li class="chapter-item expanded "><a href="hacl-c/evercrypt-apis.html"><strong aria-hidden="true">5.2.</strong> Evercrypt APIs</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="hacl-c/evercrypt-aead.html"><strong aria-hidden="true">5.2.1.</strong> AEAD</a></li><li class="chapter-item expanded "><a href="hacl-c/evercrypt-hashing.html"><strong aria-hidden="true">5.2.2.</strong> Hasing</a></li><li class="chapter-item expanded "><a href="hacl-c/evercrypt-hmac.html"><strong aria-hidden="true">5.2.3.</strong> HMAC</a></li><li class="chapter-item expanded "><a href="hacl-c/evercrypt-hkdf.html"><strong aria-hidden="true">5.2.4.</strong> HKDF</a></li><li class="chapter-item expanded "><a href="hacl-c/evercrypt-randomness.html"><strong aria-hidden="true">5.2.5.</strong> Randomness</a></li></ol></li></ol></li><li class="chapter-item expanded "><li class="part-title">HACL Rust</li><li class="chapter-item expanded "><a href="hacl-rust/index.html"><strong aria-hidden="true">6.</strong> Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="hacl-rust/aead.html"><strong aria-hidden="true">6.1.</strong> AEADs</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">HACL OCaml</li><li class="chapter-item expanded "><a href="hacl-ocaml/index.html"><strong aria-hidden="true">7.</strong> Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">HACL JavaScript</li><li class="chapter-item expanded "><a href="hacl-js/index.html"><strong aria-hidden="true">8.</strong> Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">Developer Guide</li><li class="chapter-item expanded "><a href="developers/index.html"><strong aria-hidden="true">9.</strong> Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="developers/repo-overview.html"><strong aria-hidden="true">9.1.</strong> Repository Overview</a></li><li class="chapter-item expanded "><a href="developers/build-process.html"><strong aria-hidden="true">9.2.</strong> Build Process</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="developers/rust-build.html"><strong aria-hidden="true">9.2.1.</strong> Rust</a></li><li class="chapter-item expanded "><a href="developers/ocaml-build.html"><strong aria-hidden="true">9.2.2.</strong> OCaml</a></li></ol></li><li class="chapter-item expanded "><a href="developers/ci.html"><strong aria-hidden="true">9.3.</strong> Continuous Integration</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Cryspen HACL Packages</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>The Cryspen HACL packages is a collection of cryptographic libraries developed
by Cryspen on top of <a href="https://hacl-star.github.io">HACL*</a>.
In particular, it contains a portable <a href="./hacl-c/">C crypto library</a> that selects optimized
implementations for each platform, as well as <a href="./hacl-rust/">Rust</a>, <a href="./hacl-ocaml/">OCaml</a>, and <a href="./hacl-js/">JavaScript</a>
bindings for this library.</p>
<h2 id="getting-started"><a class="header" href="#getting-started">Getting Started</a></h2>
<p>If you want to build from sources or run tests, <a href="./">start here</a>.</p>
<p>Depending on the language you are looking for there are different entry points.</p>
<ul>
<li><a href="./hacl-c/">C</a></li>
<li><a href="./hacl-rust/">Rust</a></li>
<li><a href="./hacl-ocaml/">OCaml</a></li>
<li><a href="./hacl-js/">JavaScript</a></li>
</ul>
<h2 id="contributing"><a class="header" href="#contributing">Contributing</a></h2>
<p>The Cryspen HACL packages are free and open source.
You can find the source code on <a href="https://github.com/cryspen/hacl-packages">GitHub</a> and issues and feature requests can be
posted on the <a href="https://github.com/cryspen/hacl-packages/issues">GitHub issue tracker</a>.
If you'd like to contribute, please read the <a href="https://github.com/cryspen/hacl-packages/blob/main/CONTRIBUTING.md">CONTRIBUTING</a> guide and
<a href="./developers/">developer section</a> and consider opening a <a href="https://github.com/cryspen/hacl-packages/pulls">pull request</a>.</p>
<hr />
<p>The <a href="https://hacl-star.github.io">HACL*</a> repository is a collection of high-assurance cryptographic
algorithms developed as part of <a href="https://project-everest.github.io/">Project Everest</a>.
It includes source code written in <a href="https://fstar-lang.org">F*</a>, generated code in C, verified assembly
code from the <a href="https://hacl-star.github.io/HaclValeEverCrypt.html">Vale</a> project, and an agile multiplexed cryptographic provider
called <a href="https://hacl-star.github.io/HaclValeEverCrypt.html">EverCrypt</a>.
As such, the full <a href="https://hacl-star.github.io">HACL*</a> repository contains many software artifacts.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="algorithms"><a class="header" href="#algorithms">Algorithms</a></h1>
<p>The following tables gives an overview over the algorithms supported by the HACL
packages.</p>
<p>For a detailed description fo the Support column, please see the <a href="./architectures.html">Architectures section</a>.</p>
<div class="table-wrapper"><table><thead><tr><th>Family</th><th>Algorithm</th><th>Support</th></tr></thead><tbody>
<tr><td>AEAD</td><td>AES-GCM 128</td><td>AES-NI &amp; CLMUL (x86 only)</td></tr>
<tr><td>AEAD</td><td>AES-GCM 256</td><td>AES-NI &amp; CLMUL (x86 only)</td></tr>
<tr><td>AEAD</td><td>Chacha20-Poly1305</td><td>Portable | vec128 | vec256</td></tr>
<tr><td>ECDH</td><td>Curve25519</td><td>Portable | BMI2 &amp; ADX</td></tr>
<tr><td>ECDH</td><td>P-256</td><td>Portable</td></tr>
<tr><td>Signature</td><td>Ed25519</td><td>Portable</td></tr>
<tr><td>Signature</td><td>ECDSA P-256r1</td><td>Portable</td></tr>
<tr><td>Signature</td><td>ECDSA P-256k1</td><td>Portable</td></tr>
<tr><td>Hash</td><td>SHA2-224</td><td>Portable | SHAEXT</td></tr>
<tr><td>Hash</td><td>SHA2-256</td><td>Portable | SHAEXT</td></tr>
<tr><td>Hash</td><td>SHA2-384</td><td>Portable</td></tr>
<tr><td>Hash</td><td>SHA2-512</td><td>Portable</td></tr>
<tr><td>Hash</td><td>SHA3</td><td>Portable</td></tr>
<tr><td>Hash</td><td>Blake2</td><td>Portable | vec128 | vec256</td></tr>
<tr><td>Key Derivation</td><td>HKDF</td><td>Portable (depends on hash)</td></tr>
<tr><td>Symmetric Encryption</td><td>Chacha20</td><td>Portable | vec128 | vec256</td></tr>
<tr><td>Symmetric Encryption</td><td>AES 128</td><td>AES-NI &amp; CLMUL (x86 only)</td></tr>
<tr><td>Symmetric Encryption</td><td>AES 256</td><td>AES-NI &amp; CLMUL (x86 only)</td></tr>
<tr><td>MAC</td><td>HMAC</td><td>Portable (depends on hash)</td></tr>
<tr><td>MAC</td><td>Poly1305</td><td>Portable | vec128 | vec256 | x64 ASM</td></tr>
</tbody></table>
</div>
<p>TODO:</p>
<ul>
<li><input disabled="" type="checkbox"/>
Salsa</li>
<li><input disabled="" type="checkbox"/>
Nacl API</li>
<li><input disabled="" type="checkbox"/>
x64 assembly support requirements</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="platforms"><a class="header" href="#platforms">Platforms</a></h1>
<p>The HACL Packages are supported based on the following tiers.</p>
<p>For a detailed description of the different supported architecture see the <a href="./architectures.html">next section</a>.</p>
<h3 id="tier-1"><a class="header" href="#tier-1">Tier 1</a></h3>
<p>Tier 1 targets are guaranteed to work. These targets have automated testing to
ensure that changes do not break them.</p>
<ul>
<li><input disabled="" type="checkbox" checked=""/>
x86_64 Linux (x86_64-unknown-linux-gnu)</li>
<li><input disabled="" type="checkbox" checked=""/>
x86 Linux (i686-unknown-linux-gnu)</li>
<li><input disabled="" type="checkbox" checked=""/>
x86_64 macOS (x86_64-apple-darwin)</li>
<li><input disabled="" type="checkbox" checked=""/>
x86_64 Windows
<ul>
<li><input disabled="" type="checkbox" checked=""/>
x86_64-pc-windows-msvc</li>
<li><input disabled="" type="checkbox" checked=""/>
x86_64-pc-windows-clang</li>
</ul>
</li>
<li><input disabled="" type="checkbox"/>
x86 Windows (i686-pc-windows-msvc)</li>
</ul>
<h3 id="tier-2"><a class="header" href="#tier-2">Tier 2</a></h3>
<p>Tier 2 targets are guaranteed to build.
These targets have automated builds to ensure that changes do not break the
builds. However, not all of them are always tested.</p>
<ul>
<li><input disabled="" type="checkbox"/>
arm64 macOS (aarch64-apple-darwin)</li>
<li><input disabled="" type="checkbox" checked=""/>
arm64 Linux (aarch64-unknown-linux-gnu)</li>
<li><input disabled="" type="checkbox"/>
arm64 Android (aarch64-linux-android)</li>
<li><input disabled="" type="checkbox"/>
arm64 iOS (aarch64-apple-ios)</li>
<li><input disabled="" type="checkbox" checked=""/>
s390x z14 Linux (s390x-unknown-linux-gnu)</li>
</ul>
<h3 id="tier-3"><a class="header" href="#tier-3">Tier 3</a></h3>
<p>Tier 3 targets are supported by the code but there are no automated checks and
there is no guarantee that they work.</p>
<ul>
<li>ARMv7 Android (aarch64arm-linux-androideabi)</li>
<li>arm64 iOS Simulator (aarch64-apple-ios-sim)</li>
<li>x86_64 iOS (x86_64-apple-ios)</li>
<li>PowerPC</li>
<li>IBM Z15</li>
<li>FreeBSD / x64</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="architectures"><a class="header" href="#architectures">Architectures</a></h1>
<p>The HACL C library has different optimization for different platforms.</p>
<div class="table-wrapper"><table><thead><tr><th></th><th>x86</th><th>x86-64</th><th>Arm32</th><th>Arm64</th><th>s390x</th></tr></thead><tbody>
<tr><td>Portable C</td><td>✓</td><td>✓</td><td>✓</td><td>✓</td><td>✓</td></tr>
<tr><td>Vec128</td><td>-</td><td>SSE2, SSE3, SSE4.1</td><td>-</td><td>NEON</td><td>z14</td></tr>
<tr><td>Vec256</td><td>-</td><td>AVX, AVX2</td><td>-</td><td>-</td><td>-</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="mach"><a class="header" href="#mach">mach</a></h1>
<p>The main entry point for all operations is the <code>mach</code> script.</p>
<h2 id="dependencies"><a class="header" href="#dependencies">Dependencies</a></h2>
<p>Building HACL from sources requires a set of basic dependencies</p>
<ul>
<li>cmake &gt; 3.17</li>
<li>ninja</li>
<li>python &gt; 3.8</li>
<li>clang or gcc (note that primarily clang is used)</li>
</ul>
<h2 id="command-line-reference"><a class="header" href="#command-line-reference">Command line reference</a></h2>
<pre><code>usage: mach [-h] {test,install,build,clean} ...

positional arguments:
  {test,install,build,clean}

optional arguments:
  -h, --help            show this help message and exit
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="build"><a class="header" href="#build">build</a></h1>
<pre><code>usage: mach build [-h] [-c] [--tests] [--test] [-r] [-a ALGORITHMS] [-p TARGET] [-d DISABLE]
                  [-s SANITIZER] [--msvc] [-e EDITION] [-l LANGUAGE] [-v] [-m32]

Main entry point for building HACL

    For convenience it is possible to run tests right after building using --test.

    Supported cross compilation targets:
        - x86_64-apple-darwin (macOS aarch64 only)
        - s390x
        - aarch64-apple-ios (macOS only)
        - aarch64-apple-darwin (macOS x64 only)
        - aarch64-linux-android

    Features that can be disabled (TBD):
        - vec128 (avx/neon)
        - vec256 (avx2)
        - vale (x64 assembly)

    Supported sanitizers:
        - asan
        - ubsan

    Use an edition if you want a different build. Note that this build will
    use the MSVC version by default on Windows.
    Supported editions:
        - c89

    HACL can be built for another language than C.
    Note that bindings will always require the full C library such that the
    algorithm flag will be ignored.
        - rust
        - ocaml (TBD)
        - wasm (TBD)

    💡  Windows builds are limited. The following arguments are not supported:
        - algorithms
        - sanitizer
        - edition
        - disable


optional arguments:
  -h, --help            show this help message and exit
  -c, --clean           Clean before building.
  --tests               Build tests.
  --test                Build and run tests.
  -r, --release         Build in release mode.
  -a ALGORITHMS, --algorithms ALGORITHMS
                        A list of algorithms to enable. Defaults to all.
  -p TARGET, --target TARGET
                        Define compile target for cross compilation.
  -d DISABLE, --disable DISABLE
                        Disable (hardware) features even if available.
  -s SANITIZER, --sanitizer SANITIZER
                        Enable sanitizers.
  --msvc                Use MSVC on Windows (default is clang-cl).
  -e EDITION, --edition EDITION
                        Choose a different HACL* edition.
  -l LANGUAGE, --language LANGUAGE
                        Build language bindings for the given language.
  -v, --verbose         Make builds verbose.
  -m32                  Build for 32-bit (even when on 64-bit).
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="test"><a class="header" href="#test">test</a></h1>
<pre><code>usage: mach test [-h] [-a ALGORITHMS]

Test HACL*


optional arguments:
  -h, --help            show this help message and exit
  -a ALGORITHMS, --algorithms ALGORITHMS
                        The algorithms to test.
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="the-hacl-c-package"><a class="header" href="#the-hacl-c-package">The HACL C Package</a></h1>
<p>The HACL C package is a modular, easy to use C library for low-level
cryptographic primitives.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hacl-apis"><a class="header" href="#hacl-apis">HACL APIs</a></h1>
<h2 id="algorithms-1"><a class="header" href="#algorithms-1">Algorithms</a></h2>
<ul>
<li><a href="hacl-c/./hacl-aead.html">AEAD - Authenticated Encryption with Associated Data</a></li>
<li><a href="hacl-c/./hacl-ecdh.html">ECDH - Elliptic Curve Diffie Hellman</a></li>
<li><a href="hacl-c/./hacl-hashing.html">Hashing</a></li>
<li><a href="hacl-c/./hacl-hkdf.html">HKDF - HMAC-based Key Derivation Function</a></li>
<li><a href="hacl-c/./hacl-hmac.html">HMAC - Hashed Message Authentication Code</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="aead"><a class="header" href="#aead">AEAD</a></h1>
<p>In HACL there is no multiplexing API for AEADs.
Instead each algorithm and version have to be called explicitly.</p>
<h2 id="chacha20-poly1305"><a class="header" href="#chacha20-poly1305">Chacha20-Poly1305</a></h2>
<p>HACL implements the Chacha20-Poly1305 Authenticated Encryption
with Associated Data (AEAD) construction
specified in <a href="https://tools.ietf.org/html/rfc8439">RFC 8439</a>.
The library includes three implementations of this construction,
all with the same API, for different platforms:</p>
<ul>
<li><code>Hacl_Chacha20Poly1305_32.h</code> contains the API for the portable C implementation that can be compiled and run on any platform that is 32-bit or higher.</li>
<li><code>Hacl_Chacha20Poly1305_128.h</code> contains the API for the 128-bit vectorized C implementation that can be compiled and run on any platform that supports <code>Vec128</code>.</li>
<li><code>Hacl_Chacha20Poly1305_256.h</code> contains the API for the 256-bit vectorized C implementation that can be compiled and run on any platform that supports <code>Vec256</code>.</li>
</ul>
<p>All memory for the output variables have to be allocated by the caller.</p>
<h3 id="encryption"><a class="header" href="#encryption">Encryption</a></h3>
<pre><code class="language-c">void
Hacl_Chacha20Poly1305_32_aead_encrypt(
  uint8_t *k,
  uint8_t *n,
  uint32_t aadlen,
  uint8_t *aad,
  uint32_t mlen,
  uint8_t *m,
  uint8_t *cipher,
  uint8_t *mac
);

void Hacl_Chacha20Poly1305_128_aead_encrypt(...);
void Hacl_Chacha20Poly1305_256_aead_encrypt(...);
</code></pre>
<p>The first argument <code>k</code> is a pointer to the AEAD key (the length of this array
MUST be 32 bytes);
<code>n</code> is a pointer to the AEAD nonce (the length of this array MUST be 12 bytes);
<code>aadlen</code> is the length of the associated data array <code>aad</code>;
<code>mlen</code> is the length of the input array <code>m</code>;
the output ciphertext also has <code>mlen</code> bytes and is stored in <code>cipher</code>;
the output tag has a length of 16 bytes and is stored in <code>mac</code>.</p>
<h3 id="decryption"><a class="header" href="#decryption">Decryption</a></h3>
<pre><code class="language-c">uint32_t
Hacl_Chacha20Poly1305_32_aead_decrypt(
  uint8_t *k,
  uint8_t *n,
  uint32_t aadlen,
  uint8_t *aad,
  uint32_t mlen,
  uint8_t *m,
  uint8_t *cipher,
  uint8_t *mac
);

void Hacl_Chacha20Poly1305_128_aead_decrypt(...);
void Hacl_Chacha20Poly1305_256_aead_decrypt(...);
</code></pre>
<p>The arguments <code>k</code>, <code>n</code>, <code>aadlen</code>, and <code>aad</code> are the same as in encryption.
The next argument <code>mlen</code> is the length of the input ciphertext <code>cipher</code> and
<code>mac</code> holds the input tag.
If decryption succeeds, the resulting plaintext is stored in <code>m</code> and the
function returns the success code <code>0</code>.
If decryption fails, the array <code>m</code> remains unchanged and the function returns
the error code <code>1</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hashing"><a class="header" href="#hashing">Hashing</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hmac"><a class="header" href="#hmac">HMAC</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hkdf"><a class="header" href="#hkdf">HKDF</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ecdh"><a class="header" href="#ecdh">ECDH</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="signatures"><a class="header" href="#signatures">Signatures</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="crypto-box"><a class="header" href="#crypto-box">Crypto Box</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="randomness"><a class="header" href="#randomness">Randomness</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="evercrypt-apis"><a class="header" href="#evercrypt-apis">Evercrypt APIs</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="aead-1"><a class="header" href="#aead-1">AEAD</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hashing-1"><a class="header" href="#hashing-1">Hashing</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hmac-1"><a class="header" href="#hmac-1">HMAC</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hkdf-1"><a class="header" href="#hkdf-1">HKDF</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="randomness-1"><a class="header" href="#randomness-1">Randomness</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-1"><a class="header" href="#introduction-1">Introduction</a></h1>
<p>The <code>hacl-rust</code> crate provides bindings to the HACL C package in Rust.</p>
<p>This documentation shows how to use <code>hacl-rust</code>.
There are also <a href="https://docs.rs/hacl-rust">rustdocs</a> for full API documentation.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="aeads"><a class="header" href="#aeads">AEADs</a></h1>
<p><code>hacl-rust</code> implements three AEADs</p>
<pre><code class="language-rust noplayground">pub enum Algorithm {
    /// AES GCM 128
    Aes128Gcm = Spec_Agile_AEAD_AES128_GCM,

    /// AES GCM 256
    Aes256Gcm = Spec_Agile_AEAD_AES256_GCM,

    /// ChaCha20 Poly1305
    Chacha20Poly1305 = Spec_Agile_AEAD_CHACHA20_POLY1305,
}
</code></pre>
<p>There are two different ways of using AEADs.</p>
<h2 id="single-shot-api"><a class="header" href="#single-shot-api">Single shot API</a></h2>
<p>The entrypoint for many people will be the single shot API that takes all
necessary arguments in one function call.</p>
<pre><code class="language-rust noplayground">    let (ciphertext, tag) =
        aead::encrypt(Algorithm::Chacha20Poly1305, &amp;key, &amp;msg, &amp;iv, &amp;aad).unwrap();
</code></pre>
<pre><code class="language-rust noplayground">    let msg_ = aead::decrypt(
        Algorithm::Chacha20Poly1305,
        &amp;key,
        &amp;ciphertext,
        &amp;tag,
        &amp;iv,
        &amp;aad,
    )
    .unwrap();
</code></pre>
<h2 id="stateful-api"><a class="header" href="#stateful-api">Stateful API</a></h2>
<p>In many cases a key is used multiple times though.
For this case there's a stateful API.</p>
<pre><code class="language-rust noplayground">    let cipher = Aead::new(Algorithm::Chacha20Poly1305, &amp;key).unwrap();
</code></pre>
<pre><code class="language-rust noplayground">    let (ciphertext, tag) = cipher.encrypt(&amp;msg, &amp;iv, &amp;aad).unwrap();
    let msg_ = cipher.decrypt(&amp;ciphertext, &amp;tag, &amp;iv, &amp;aad).unwrap();
</code></pre>
<h2 id="in-place-apis"><a class="header" href="#in-place-apis">In-place APIs</a></h2>
<p>The API also allows to use in-place encryption and decryption, which avoids
having to allocate memory for the result.</p>
<pre><code class="language-rust noplayground">    pub fn encrypt_in_place(
        &amp;self,
        payload: &amp;mut [u8],
        iv: &amp;[u8],
        aad: &amp;Aad,
    ) -&gt; Result&lt;Vec&lt;u8&gt;, Error&gt; {
</code></pre>
<pre><code class="language-rust noplayground">    pub fn decrypt_in_place(
        &amp;self,
        payload: &amp;mut [u8],
        tag: &amp;[u8],
        iv: &amp;[u8],
        aad: &amp;Aad,
    ) -&gt; Result&lt;(), Error&gt; {
</code></pre>
<h2 id="combined-apis"><a class="header" href="#combined-apis">Combined APIs</a></h2>
<p>In many protocols such as TLS the tag is appended to the cipher text.
To avoid unnecessary copy operations there's an API doing this for you.</p>
<pre><code class="language-rust noplayground">    pub fn encrypt_combined(&amp;self, msg: &amp;[u8], iv: &amp;[u8], aad: &amp;Aad) -&gt; Result&lt;Ciphertext, Error&gt; {
</code></pre>
<pre><code class="language-rust noplayground">    pub fn decrypt_combined(&amp;self, ctxt: &amp;[u8], iv: &amp;[u8], aad: &amp;Aad) -&gt; Result&lt;Vec&lt;u8&gt;, Error&gt; {
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-2"><a class="header" href="#introduction-2">Introduction</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-3"><a class="header" href="#introduction-3">Introduction</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-4"><a class="header" href="#introduction-4">Introduction</a></h1>
<h2 id="contributing-1"><a class="header" href="#contributing-1">Contributing</a></h2>
<p>See CONTRIBUTING.md</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="repository-overview"><a class="header" href="#repository-overview">Repository Overview</a></h1>
<p>The <a href="https://github.com/cryspen/hacl-packages">hacl-packages repository</a> is a mono repository for all HACL packages and
bindings.
The top level holds the HACL C library that is based on the output of <a href="https://github.com/project-everest/hacl-star">HACL*</a>.</p>
<h2 id="source-code"><a class="header" href="#source-code">Source Code</a></h2>
<p>The C source code lives in the <code>src</code> directory for most platforms and the
standard editions.
The c89 edition can be found in <code>src/c89</code> and the source code for MSVC is found
int <code>src/msvc</code>.</p>
<p>The includes are found in the corresponding <code>include</code> directories (<code>include</code>,
<code>include/c89</code>, and <code>include/msvc</code>).</p>
<p>Vale is considered an external dependency and therefore lives in its own
directory <code>vale</code> --- sources in <code>vale/src</code> and headers in <code>vale/include</code>.</p>
<h3 id="tests"><a class="header" href="#tests">Tests</a></h3>
<p>Tests are found in the <code>tests</code> folder and are written in modern C++ rather than
C.</p>
<h3 id="karamel"><a class="header" href="#karamel">Karamel</a></h3>
<p>The <a href="https://github.com/FStarLang/karamel">KaRaMeL</a> dependency is found in <code>karamel</code> and holds only headers that are
used by the HACL C source code.</p>
<h3 id="cpu-features"><a class="header" href="#cpu-features">CPU Features</a></h3>
<p>A tool for basic CPU feature detection can be found in <code>cpu-features</code>.
This is only used for tests and will probably be removed from this repository
in future.</p>
<h2 id="tools"><a class="header" href="#tools">Tools</a></h2>
<p>The build is driven by the <code>mach</code> script and the <code>CMakeLists.txt</code>.
They rely on the contents of the <code>tools</code> folder (general tools for managing the
repository and building in Python), as well as the <code>config</code> folder (platform
detection and build configuration helper).</p>
<h3 id="docker"><a class="header" href="#docker">Docker</a></h3>
<p>Docker tools for extracting the source code from <a href="https://github.com/project-everest/hacl-star">HACL*</a> are found in <code>docker</code>.</p>
<h3 id="docs"><a class="header" href="#docs">Docs</a></h3>
<p>The <code>docs</code> folder contains this book you're reading right now.</p>
<h2 id="bindings"><a class="header" href="#bindings">Bindings</a></h2>
<p>The language bindings are in sub folders.</p>
<h3 id="rust"><a class="header" href="#rust">Rust</a></h3>
<p>The Rust bindings can be found in the <code>rust</code> folder.
See the <a href="developers/./ocaml-build.html">Rust chapter</a> for more details on the build and structure.</p>
<h3 id="ocaml"><a class="header" href="#ocaml">OCaml</a></h3>
<p>The OCaml bindings can be found in the <code>ocaml</code> folder.
See the <a href="developers/./rust-build.html">OCaml chapter</a> for more details on the build and structure.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="build-process"><a class="header" href="#build-process">Build Process</a></h1>
<p>The HACL C library is built with <a href="https://cmake.org/">CMake</a> and <a href="https://ninja-build.org/">ninja</a> and uses a Python driver
script called <code>mach</code>.
Due to the modular nature of the library the build is more complex than for
many other libraries.</p>
<h2 id="selecting-algorithms"><a class="header" href="#selecting-algorithms">Selecting Algorithms</a></h2>
<p>The algorithms compiled into the library can be selected using the <code>-a|--algorithm</code>
argument on <code>mach</code>.
By default all algorithms are selected.
The files used in the build are selected by running a dependency analysis on the
requested algorithm files (see <code>configure.py</code>).
The resulting configuration is written into <code>config/config.cmake</code>, which is used
as input into the main build process.
This process is part of the <code>mach</code> script.</p>
<h2 id="platform-detection"><a class="header" href="#platform-detection">Platform Detection</a></h2>
<p>Depending on the used toolchain a different set of algorithms can be used.
In order to define the feature set available in the toolchain CMake runs a set
of tests.
The resulting configuration is written into <code>config/cached-config.txt</code> for
bindings to use.
Note that the toolchain feature must not be the same as the platform feature
set the build is running on (due to cross compilation or extended features in the
toolchain compared to the actual hardware).
The library has runtime feature detection to ensure that hardware features are
only used when they are actually available.</p>
<h2 id="release-builds"><a class="header" href="#release-builds">Release Builds</a></h2>
<p>By default the builds use the debug mode.
For release builds</p>
<pre><code>./mach build --release
</code></pre>
<p>is used.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rust-1"><a class="header" href="#rust-1">Rust</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ocaml-1"><a class="header" href="#ocaml-1">OCaml</a></h1>
<p>There are two different ways of building the OCaml bindings.</p>
<h2 id="mach-dev-mode"><a class="header" href="#mach-dev-mode">Mach (Dev Mode)</a></h2>
<p>When working on the library <code>mach</code> offers a convenient way of building the C
library and the ocaml bindings through <code>mach</code> using the <code>-l|--language</code> argument.</p>
<pre><code>./mach build -l ocaml
</code></pre>
<p>This build the C library, copies the result into the <code>ocaml</code> directory, and then
builds the OCaml bindings on top.
Tests can be called through mach as well <code>./mach test -l ocaml</code>.</p>
<h2 id="standalone-packaging"><a class="header" href="#standalone-packaging">Standalone (Packaging)</a></h2>
<p>For packaging the hacl-star opam package the bindings can be built standalone.
In this case the local copy of the HACL C library is ignored.
Instead a fresh copy is pulled from the git repository and built locally within
the <code>ocaml</code> directory.
The following command run in the <code>ocaml</code> directory will build a standalone
version of the package.</p>
<pre><code>./setup.py
export HACL_MAKE_CONFIG=hacl-packages/config/cached-config.txt
make ocamlevercrypt.cmxa
make -j
</code></pre>
<p>First we need to get the HACL C code, build it, and put it where the Makefile
expects the result.
This is what the <code>setup.py</code> script does.
Because the OCaml build requires information about the platform features we
export <code>HACL_MAKE_CONFIG</code> to point to the CMake generated information.
Then we can build the bindings with make.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="continuous-integration"><a class="header" href="#continuous-integration">Continuous Integration</a></h1>
<p>The HACL Packages project uses <a href="https://docs.github.com/en/actions">GitHub Actions</a> as its primary CI/CD system.</p>
<p>When a pull request (PR) or push is made to HACL Packages, the CI automatically runs a series of checks to ensure that all code compiles, all tests pass, and all changes are of a certain quality.
To reduce the amount of computational work, the HACL Packages CI is configured to ignore commits that don't justify a CI run.
For example, the CI will not run on changes of the README.md (and other <code>*.md</code> files in the root folder).
If, for whatever reason, you think that a particular commit should not start the CI, consider including <code>[skip ci]</code> to your commit message.
(See <a href="https://github.blog/changelog/2021-02-08-github-actions-skip-pull-request-and-push-workflows-with-skip-ci/">Skip pull request and push workflows</a>.)</p>
<h1 id="workflows"><a class="header" href="#workflows">Workflows</a></h1>
<p>The CI configuration files are located in the <code>.github/workflows</code> folder.
Local actions reused across the HACL Packages CI are in the <code>.github/actions</code> folder.</p>
<p>There are multiple workflow files with the following tasks:</p>
<ul>
<li><code>build.yml</code> builds and tests HACL Packages on many systems (see below).</li>
<li><code>gh-pages.yml</code> builds and publishes new versions of this book.</li>
<li><code>new_issue.yml</code> adds newly created issues to the <a href="https://github.com/orgs/cryspen/projects/1">HACL Packages project board</a>.</li>
<li><code>ocaml.yml</code> builds the OCaml bindings for HACL packages.</li>
<li><code>rust.yml</code> builds the Rust bindings for HACL packages.</li>
</ul>
<h2 id="what-systems-are-tested"><a class="header" href="#what-systems-are-tested">What systems are tested?</a></h2>
<p>GitHub Actions uses the concept of a &quot;job matrix&quot; to fan out a single job description to multiple separate jobs.
This is useful to test a job on different systems, e.g., Linux, macOS, and Windows.
In HACL Packages, and especially in the <code>build</code> workflow, we use matrices of the form ...</p>
<pre><code class="language-yaml">matrix:
  compiler: [ gcc, clang ]
  version: [ 7, 8, ..., 14 ]
  bits: [ 32, 64 ]
  edition: [ c89, &quot;&quot; ]
  exclude:
    - compiler: gcc
      version: 12
    # ...
    # Not available
    - compiler: clang
      version: 14
</code></pre>
<p>... to cover the following targets:</p>
<div class="table-wrapper"><table><thead><tr><th>Virtual Environment</th><th>Compiler</th><th>Architecture</th></tr></thead><tbody>
<tr><td><strong>Tier 1</strong></td><td></td><td></td></tr>
<tr><td>Linux (ubuntu-latest)</td><td>gcc (7-11), clang (7-12)</td><td>x86_64, i686</td></tr>
<tr><td>macOS (macos-latest)</td><td>gcc (9-12), clang (11-14)</td><td>x86_64</td></tr>
<tr><td>Windows (windows-latest)</td><td>clang-cl (latest), msvc (latest)</td><td>x86_64, i686</td></tr>
<tr><td><strong>Tier 2</strong></td><td></td><td></td></tr>
<tr><td>Linux (ubuntu-latest)</td><td>gcc (9-12), clang (11-14)</td><td>aarch64</td></tr>
<tr><td>macOS (macos-latest)</td><td>gcc (9-12), clang (11-14)</td><td>aarch64</td></tr>
<tr><td>Android (ubuntu-latest)</td><td>gcc (latest)</td><td>aarch64</td></tr>
<tr><td>iOS (macos-latest)</td><td>gcc (9-12), clang (11-14)</td><td>aarch64</td></tr>
<tr><td><strong>Tier 3</strong></td><td></td><td></td></tr>
<tr><td>s390x (ubuntu-latest)</td><td>gcc (latest)</td><td>aarch64</td></tr>
</tbody></table>
</div>
<p>Furthermore, on Linux, we test different &quot;editions&quot; of the C programming language, i.e., &quot;c89&quot;.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
    </body>
</html>
